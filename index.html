<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>関西医科大学ラグビー部OB会</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Password Gate -->
  <div id="gate" class="gate">
    <div class="gate__card">
      <h2>会員専用ページ</h2>
      <p class="muted">
        このページはOB会会員向けです。<br>
        合言葉（パスワード）を入力してください。<br>
        ※ いったん通過すると<strong>24時間</strong>は再入力不要です。
      </p>

      <div class="gate__row">
        <input id="pw" type="password" placeholder="パスワード" autocomplete="current-password" />
        <button id="pwBtn" class="btn btn--primary">入室</button>
      </div>
      <p id="pwErr" class="error" aria-live="polite"></p>

      <div class="gate__foot muted">
        ※ パスワードは第三者に共有しないでください。
      </div>
    </div>
  </div>

  <!-- Site -->
  <header class="topbar">
    <div class="wrap topbar__inner">
      <div class="brand">
        <div class="brand__badge">KMU</div>
        <div class="brand__text">
          <div class="brand__title">関西医科大学ラグビー部OB会</div>
          <div class="brand__subtitle">Kansai Medical University Rugby club</div>
        </div>
      </div>

      <nav class="nav">
        <a href="#contact" class="nav__link">連絡先登録</a>
        <a href="#news" class="nav__link">お知らせ</a>
        <a href="#schedule" class="nav__link">予定表</a>
        <a href="accounting.html" class="nav__link nav__link--highlight">会計年次報告</a>
        <a href="magazine.html" class="nav__link">部誌</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero">
      <div class="hero__inner">
        <h1>OB会ホームページ</h1>
        <p>
          連絡先の更新・最新のお知らせ・練習／試合予定・会計報告・部誌の閲覧をまとめています。
          <br>※ 内容は随時更新されます。
        </p>

        <div class="hero__cta">
          <a class="btn btn--primary" href="#contact">連絡先登録フォームへ</a>
          <a class="btn" href="magazine.html">部誌を見る</a>
          <a class="btn" href="accounting.html">会計年次報告</a>
        </div>
      </div>
    </section>

    <section class="grid">
      <!-- Contact -->
      <article id="contact" class="card">
        <h2>連絡先の確認・登録</h2>
        <p class="muted">
          OB会からのご連絡（メール／郵送）に必要な情報の確認・更新をお願いします。
        </p>
        <a class="btn btn--primary" target="_blank" rel="noopener"
           href="https://docs.google.com/forms/d/e/1FAIpQLSeCmVJEP1rfuQdIvcYm5URyk_26z0yZFeivVwO6i3mG4ubHJA/viewform?usp=publish-editor">
          連絡先登録フォームを開く
        </a>
        <p class="muted small">
          ※ フォームが開かない場合は、ブラウザ（Chrome/Edge/Safari）でお試しください。
        </p>
      </article>

      <!-- Accounting Link -->
      <article class="card">
        <h2>会計年次報告</h2>
        <p class="muted">
          年度ごとの収入・支出・差額や支出内訳などを、会員向けに分かりやすく公開します。
        </p>
        <a class="btn btn--primary" href="accounting.html">会計年次報告を見る</a>
        <p class="muted small">
          ※ 個人情報（振込人名など）は掲載しません。
        </p>
      </article>

      <!-- Magazine Link -->
      <article class="card">
        <h2>部誌（PDF）</h2>
        <p class="muted">
          部誌はPDFで閲覧できます。年度ごとの一覧ページにまとめています。
        </p>
        <a class="btn" href="magazine.html">部誌ページへ</a>
      </article>
    </section>

    <!-- News -->
    <section id="news" class="section">
      <div class="section__head">
        <h2>お知らせ</h2>
        <p class="muted">最新のお知らせを表示します（Googleスプレッドシート連携）。</p>
      </div>

      <div class="embed">
        <iframe
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT2CNdb3UMpKUIb5k-WElzt-iv8sBftYOga0gkMO6jgciZNJNfLwVee0T2u8MajPtfjxQ22ESKh45Xi/pubhtml?gid=0&single=true"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="お知らせ">
        </iframe>
      </div>

      <p class="muted small">
        ※ 表が崩れる場合は、シート側の列幅を少し広げると改善します。
      </p>
    </section>

    <!-- Schedule -->
    <section id="schedule" class="section">
      <div class="section__head">
        <h2>活動予定表</h2>
        <p class="muted">練習日程・試合日程など（Googleカレンダー連携）。</p>
      </div>

      <div class="embed embed--calendar">
        <iframe
          src="https://calendar.google.com/calendar/embed?src=kmu.rugby.ob%40gmail.com&ctz=Asia%2FTokyo"
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="活動予定表">
        </iframe>
      </div>
    </section>

    <footer class="footer">
      <div class="footer__inner">
        <div class="muted small">
          ※ 本サイトは関西医科大学ラグビー部OB会の会員向け情報を掲載しています。<br>
          ※ 内容の転載は禁止転載はご遠慮ください。
        </div>
      </div>
    </footer>
  </main>

  <script>
    // ===== Password Gate (24h) =====
    // 既存サイトの合言葉をここに設定してください（以前の「全体パスワード」）
    const SITE_PASSWORD = "kmu-rugby-makino"; // ←必ず変更

    const KEY = "kmu_ob_gate_until"; // localStorage key
    const ONE_DAY_MS = 24 * 60 * 60 * 1000;

    const gate = document.getElementById("gate");
    const pw = document.getElementById("pw");
    const pwBtn = document.getElementById("pwBtn");
    const pwErr = document.getElementById("pwErr");

    function now() { return Date.now(); }

    function isAllowed() {
      const until = Number(localStorage.getItem(KEY) || 0);
      return until && until > now();
    }

    function openSite() {
      gate.style.display = "none";
      document.body.style.overflow = "auto";
    }

    function lockSite() {
      gate.style.display = "flex";
      document.body.style.overflow = "hidden";
    }

    function tryLogin() {
      if (pw.value === SITE_PASSWORD) {
        localStorage.setItem(KEY, String(now() + ONE_DAY_MS));
        pwErr.textContent = "";
        openSite();
      } else {
        pwErr.textContent = "パスワードが違います。もう一度お試しください。";
        pw.value = "";
        pw.focus();
      }
    }

    // init
    if (isAllowed()) openSite(); else lockSite();

    pwBtn.addEventListener("click", tryLogin);
    pw.addEventListener("keydown", (e) => {
      if (e.key === "Enter") tryLogin();
    });
  </script>
</body>
</html>

